define(["jquery","underscore","backbone"],function(t,e,a){var o=a.View.extend({isFramesView:!0,events:{"click .frame-link":"goToFrameEvent","click .frame-next":"goToNextFrameEvent","click .frame-prev":"goToPreviousFrameEvent"},constructor:function(o){this.default_options={fill_screen:!1,scroll_distance:300},this.options=t.extend(!0,this.default_options,o),this.currentFrame=0,this.el_height=0,this.scrollLength=0,this.offset_top_position=0,this.above_height=0,this.offset_top=0,this.skroll_data=[],t(window).scroll(e.debounce(e.bind(this.scrolled,this),10)),Modernizr.touch&&t(window).on("touchstart touchmove touchend",e.debounce(e.bind(this.scrolled,this),10)),a.View.apply(this,arguments)},getHeight:function(){return this.scrollLength+this.el_height},setupFrames:function(a){a="undefined"!=typeof a?a:this.options.offset_top,this.offset_top=a;var o=this.$(".frames-context-above").length>0,s=this.$(".frames-context-above").length>0;this.removeSkrollData();var i=this;this.frames=[],this.max_frame_height=0,this.$(".frames .frame").each(function(e){i.frames[e]={$frame:t(this),skroll_data:[]},i.max_frame_height=Math.max(i.max_frame_height,t(this).outerHeight())}),this.offset_top_position=0,this.above_height=o?this.$(".frames-context-above").outerHeight():0;var h=s?this.$(".frames-context-below").outerHeight():0;this.el_height=this.above_height+h+this.max_frame_height,t(window).height()>this.el_height&&(this.offset_top_position=(t(window).height()-this.el_height)/2,this.el_height=t(window).height()-this.el_height+this.el_height),this.scrollLength=this.frames.length*this.options.scroll_distance;var r=a+this.scrollLength,n=r+this.el_height,l=this.above_height+this.max_frame_height,f=a-this.offset_top_position;o&&this.$(".frames-context-above ").attr("data-0","top:"+a+"px").attr("data-"+f,"top:"+this.offset_top_position+"px").attr("data-"+r,"top:"+this.offset_top_position+"px").attr("data-"+n,"top:-"+this.el_height+"px"),s&&(this.$(".frames-context-below ").attr("data-0","top:"+(a+l)+"px").attr("data-"+f,"top:"+l+"px").attr("data-"+r,"top:"+l+"px").attr("data-"+n,"top:-"+(this.el_height-l)+"px"),this.skroll_data.push("data-0"),this.skroll_data.push("data-"+f),this.skroll_data.push("data-"+r),this.skroll_data.push("data-"+n));var c=a;e.each(this.frames,function(t,e){var a=c+i.options.scroll_distance,o=0===e?"block":"none",s=e+1===i.frames.length?"block":"none";t.$frame.attr("data-0","top:"+(c+i.above_height)+"px;display:"+o).attr("data-"+(c-i.offset_top_position),"top:"+(i.above_height+i.offset_top_position)+"px;display:block").attr("data-"+a,"top:"+(i.above_height+i.offset_top_position)+"px").attr("data-"+(a-i.offset_top_position),"display:"+s).attr("data-"+n,"top:-"+(i.el_height-i.above_height)+"px"),t.skroll_data.push("data-0"),t.skroll_data.push("data-"+(c-i.offset_top_position)),t.skroll_data.push("data-"+a),t.skroll_data.push("data-"+(a-i.offset_top_position)),t.skroll_data.push("data-"+n),c=a})},removeSkrollData:function(){var t=this;e.each(this.skroll_data,function(e){t.$(".frames-context-above").length>0&&(t.$(".frames-context-above").removeAttr(e),t.$(".frames-context-above").removeData(e)),t.$(".frames-context-below").length>0&&(t.$(".frames-context-below").removeAttr(e),t.$(".frames-context-below").removeData(e))}),this.skroll_data=[],e.each(this.frames,function(t){e.each(t.skroll_data,function(e){t.$frame.removeAttr(e),t.$frame.removeData(e)}),t.skroll_data=[]})},scrolled:function(){var t=this;e.each(this.frames,function(e){"block"===e.$frame.css("display")&&(t.currentFrame=e.$frame.attr("data-id").split("frame")[1])}),this.$(".frame-nav .frame-link").removeClass("active"),this.$(".frame-nav .frame-link-"+this.currentFrame).addClass("active")},goToFrameEvent:function(e){e.preventDefault(),this.goToFrame(t(e.currentTarget).data("target"))},goToNextFrameEvent:function(t){t.preventDefault(),this.goToFrame((this.currentFrame+1)%this.frames.length)},goToPreviousFrameEvent:function(t){t.preventDefault(),this.goToFrame(this.currentFrame-1>=0?this.currentFrame-1:this.frames.length-1)},goToFrame:function(a,o){"undefined"!=typeof this.frames[a]&&t(this.el).trigger("scrollEvent",{offset:this.offset_top+(a+.5)*this.options.scroll_distance-this.offset_top_position,duration:"undefined"!=typeof o?o:0,callback:setTimeout(e.bind(this.scrolled,this),200)})}});return o});
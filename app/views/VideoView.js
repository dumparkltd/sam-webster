define(["jquery","underscore","backbone"],function(e,a,t){var i=t.View.extend({constructor:function(i){this.default_options={play_tolerance:400,auto_play:!1,player:{height:"100%",width:"100%"}},this.options=e.extend(!0,this.default_options,i),this.players=[],this.playing=!1,this.auto_played=!1,e(window).scroll(a.debounce(a.bind(this.scrolled,this),100)),t.View.apply(this,arguments)},initPlayers:function(){var t=this;a.each(this.players,function(i){var n=e.extend(!0,this.default_options,i);i.player=window.player=new YT.Player(n.player_el,{height:n.height,width:n.width,frameborder:0,videoId:n.player_id,events:{onReady:a.bind(t.onPlayerReady,t),onPlaybackQualityChange:a.bind(t.onPlayerPlaybackQualityChange,t),onStateChange:a.bind(t.onPlayerStateChange,t),onError:a.bind(t.onPlayerError,t)},playerVars:{controls:1,modestbranding:1,autohide:1,enablejsapi:1,showinfo:0,rel:0,autoplay:0}})})},onPlayerReady:function(){},onPlayerPlaybackQualityChange:function(){},onPlayerStateChange:function(e){e.data===YT.PlayerState.PLAYING?(this.playing&&this.playing.player.pauseVideo(),this.playing=this.getPlayer(e.target.d.id)):(e.data===YT.PlayerState.ENDED||e.data===YT.PlayerState.PAUSED)&&this.getPlayer(e.target.d.id)===this.playing&&(this.playing=!1),window._gaq.push(["_trackEvent","video","video-"+e.target.d.id,"state-"+e.data])},getPlayer:function(e){var t=!1;return a.each(this.players,function(a){a.player_el===e&&(t=a)}),t},onPlayerError:function(){},scrolled:function(){var a=e(document).scrollTop()-this.$el.offset().top;a<-1*this.options.play_tolerance||a>this.$el.outerHeight()-e(window).height()?this.playing&&this.playing.player.pauseVideo():this.options.auto_play&&!this.auto_played&&"undefined"!=typeof this.players[0].player&&(this.auto_played=!0,this.players[0].player.playVideo())}});return i});